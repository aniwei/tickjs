$gwx_XC_93=function(_,_v,_n,_p,_s,_wp,_wl,$gwn,$gwl,$gwh,wh,$gstack,$gwrt,gra,grb,TestTest,wfor,_ca,_da,_r,_rz,_o,_oz,_1,_1z,_2,_2z,_m,_mz,nv_getDate,nv_getRegExp,nv_console,nv_parseInt,nv_parseFloat,nv_isNaN,nv_isFinite,nv_decodeURI,nv_decodeURIComponent,nv_encodeURI,nv_encodeURIComponent,$gdc,nv_JSON,_af,_gv,_ai,_grp,_gd,_gapi,$ixc,_ic,_w,_ev,_tsd){return function(path,global){
if(typeof global==='undefined'){if (typeof __GWX_GLOBAL__==='undefined')global={};else global=__GWX_GLOBAL__;}if(typeof __WXML_GLOBAL__ === 'undefined') {__WXML_GLOBAL__={};
}__WXML_GLOBAL__.modules = __WXML_GLOBAL__.modules || {};
var e_={}
if(typeof(global.entrys)==='undefined')global.entrys={};e_=global.entrys;
var d_={}
if(typeof(global.defines)==='undefined')global.defines={};d_=global.defines;
var f_={}
if(typeof(global.modules)==='undefined')global.modules={};f_=global.modules || {};
var p_={}
__WXML_GLOBAL__.ops_cached = __WXML_GLOBAL__.ops_cached || {}
__WXML_GLOBAL__.ops_set = __WXML_GLOBAL__.ops_set || {};
__WXML_GLOBAL__.ops_init = __WXML_GLOBAL__.ops_init || {};
var z=__WXML_GLOBAL__.ops_set.$gwx_XC_93 || [];
function gz$gwx_XC_93_1(){
if( __WXML_GLOBAL__.ops_cached.$gwx_XC_93_1)return __WXML_GLOBAL__.ops_cached.$gwx_XC_93_1
__WXML_GLOBAL__.ops_cached.$gwx_XC_93_1=[];
(function(z){var a=11;function Z(ops){z.push(ops)}
Z([[7],[3,'$taroCompReady']])
Z([[2,'+'],[1,'b-product-detail'],[[2,'?:'],[[7],[3,'isShowContent']],[1,''],[1,' b-product-detail-hide']]])
Z([[2,'?:'],[[7],[3,'isShowContent']],[1,'auto'],[1,'none']])
Z([[7],[3,'anonymousState__temp']])
Z([[7],[3,'isShowContent']])
Z(z[4])
Z([[7],[3,'$compid__1438']])
Z([[7],[3,'isShowShareMenu']])
Z([[7],[3,'$compid__1439']])
})(__WXML_GLOBAL__.ops_cached.$gwx_XC_93_1);return __WXML_GLOBAL__.ops_cached.$gwx_XC_93_1
}
__WXML_GLOBAL__.ops_set.$gwx_XC_93=z;
__WXML_GLOBAL__.ops_init.$gwx_XC_93=true;
var x=['./pages/index/_index/product_detail/product_detail.wxml'];d_[x[0]]={}
var m0=function(e,s,r,gg){
var z=gz$gwx_XC_93_1()
var lUS=_v()
_(r,lUS)
if(_oz(z,0,e,s,gg)){lUS.wxVkey=1
var aVS=_mz(z,'view',['class',1,'pointerEvents',1,'style',2],[],e,s,gg)
var tWS=_v()
_(aVS,tWS)
if(_oz(z,4,e,s,gg)){tWS.wxVkey=1
}
var eXS=_v()
_(aVS,eXS)
if(_oz(z,5,e,s,gg)){eXS.wxVkey=1
var oZS=_n('product-detail-base')
_rz(z,oZS,'compid',6,e,s,gg)
_(eXS,oZS)
}
var bYS=_v()
_(aVS,bYS)
if(_oz(z,7,e,s,gg)){bYS.wxVkey=1
var x1S=_n('product-share')
_rz(z,x1S,'compid',8,e,s,gg)
_(bYS,x1S)
}
tWS.wxXCkey=1
eXS.wxXCkey=1
eXS.wxXCkey=3
bYS.wxXCkey=1
bYS.wxXCkey=3
_(lUS,aVS)
}
lUS.wxXCkey=1
lUS.wxXCkey=3
return r
}
e_[x[0]]={f:m0,j:[],i:[],ti:[],ic:[]}
if(path&&e_[path]){
return function(env,dd,global){$gwxc=0;var root={"tag":"wx-page"};root.children=[]
;g="$gwx_XC_93";var main=e_[path].f
if (typeof global==="undefined")global={};global.f=$gdc(f_[path],"",1);
try{
main(env,{},root,global);
_tsd(root)
}catch(err){
console.log(err)
}
;g="";
return root;
}
}
}
}(__g.a,__g.b,__g.c,__g.d,__g.e,__g.f,__g.g,__g.h,__g.i,__g.j,__g.k,__g.l,__g.m,__g.n,__g.o,__g.p,__g.q,__g.r,__g.s,__g.t,__g.u,__g.v,__g.w,__g.x,__g.y,__g.z,__g.A,__g.B,__g.C,__g.D,__g.E,__g.F,__g.G,__g.H,__g.I,__g.J,__g.K,__g.L,__g.M,__g.N,__g.O,__g.P,__g.Q,__g.R,__g.S,__g.T,__g.U,__g.V,__g.W,__g.X,__g.Y,__g.Z,__g.aa);if(__vd_version_info__.delayedGwx||false)$gwx_XC_93();	if (__vd_version_info__.delayedGwx) __wxAppCode__['pages/index/_index/product_detail/product_detail.wxml'] = [$gwx_XC_93, './pages/index/_index/product_detail/product_detail.wxml'];else __wxAppCode__['pages/index/_index/product_detail/product_detail.wxml'] = $gwx_XC_93( './pages/index/_index/product_detail/product_detail.wxml' );
	;__wxRoute = "pages/index/_index/product_detail/product_detail";__wxRouteBegin = true;__wxAppCurrentFile__="pages/index/_index/product_detail/product_detail.js";define("pages/index/_index/product_detail/product_detail.js",function(require,module,exports,window,document,frames,self,location,navigator,localStorage,history,Caches,screen,alert,confirm,prompt,XMLHttpRequest,WebSocket,Reporter,webkit,WeixinJSCore){
(wx.webpackJsonp=wx.webpackJsonp||[]).push([[334],{1242:function(t,e,o){"use strict";o.r(e);var n,r=o(570),a=o.n(r);for(n in r)"default"!==n&&function(t){o.d(e,t,(function(){return r[t]}))}(n);e.default=a.a},1917:function(t,e,o){t.exports=o.p+"pages/index/_index/product_detail/product_detail.wxml"},3558:function(t,e,o){"use strict";o.r(e),o(3559);var n,r=o(1242);for(n in r)"default"!==n&&function(t){o.d(e,t,(function(){return r[t]}))}(n)},3559:function(t,e,o){"use strict";o(1917)},3560:function(t,e,o){},570:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=b(o(3)),r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o,n=arguments[e];for(o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},a=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var o=[],n=!0,r=!1,a=void 0;try{for(var i,s=t[Symbol.iterator]();!(n=(i=s.next()).done)&&(o.push(i.value),!e||o.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return o}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(t,e,o){return e&&s(t.prototype,e),o&&s(t,o),t};function s(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u,c=o(6),d=o(0),p=b(d),l=o(4),f=o(28),h=b(o(14)),g=o(26),v=b(o(13)),m=b(o(11)),y=o(29),S=b(o(2)),_=b(o(1)),w=o(51),P=o(22),k=b(o(5)),I=o(71);function b(t){return t&&t.__esModule?t:{default:t}}function D(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}function x(t){return function(){var e=t.apply(this,arguments);return new Promise((function(t,o){return function n(r,a){try{var i=e[r](a),s=i.value}catch(r){return void o(r)}if(!i.done)return Promise.resolve(s).then((function(t){n("next",t)}),(function(t){n("throw",t)}));t(s)}("next")}))}}function L(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}o(3560);var A={categoryName:"",activity_ids:[],categoryId:0,productId:0,skusData:[],supportTakeaway:!0,name:"",accessoryList:[],exclusiveList:[],imageURL:"",images:[],imagesList:[],videos:[],labels:[],description:"",hasStock:!0,attributeStr:"",price:{originPrice:0,discountPrice:0,materialPrice:0,redemptionDiscountPrice:-1},quantity:0,isPreMade:0,isSoldOutForever:0,hasBoxFee:0,imgIndex:null,nameImage:"",showTrademark:!1,supportReverseElection:!1};function C(){var t,e,o=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,C);for(var i,s,u,c=arguments.length,d=Array(c),l=0;l<c;l++)d[l]=arguments[l];return(t=e=L(this,(t=C.__proto__||Object.getPrototypeOf(C)).call.apply(t,[this].concat(d)))).$usedState=["anonymousState__temp","$compid__1438","$compid__1439","isShowContent","isShowShareMenu","productDetail","networkType","imgIndex","dataLoaded","rnShareData","optionalProductsBase","isParty","__fn_on","shoppingBagStore"],e.bagProductList=function(t){var o=e.getNonAdditiveBagList()||[];return!(!t||!o.length)},e.checkOptionalProducts=(u=x(n.default.mark((function t(r,i,s){var u,c,d,p,l,f,h,g;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h=e.props.shoppingBagStore,f=((h||{}).shop||{}).id,p=(l=i||{}).accessoryList,u=l.categoryId,c=l.productId,l=void 0===(h=l.skusData)?[]:h,h=(0,w.generateIds)(p),p=a(h,1),d=p[0],h=void 0,0<d.length?(p=l.find((function(t){return d[0]===t.specifications})))&&(p=p.id,h=p):0<l.length&&(l=(l=(l=a(l,1))[0]).id,h=l),f={categoryId:u,optionalProducts:r&&r.length?r.map((function(t){var e=t||{},o=e.productId,n=e.skuId,r=e.skuNo,a=e.uniqueId;return t=e.materialIds,{categoryId:e.categoryId,materialIds:t&&t.length?t.map((function(t){return Number(t.split(":")[1])})):[],productId:o,skuId:n,skuNo:r,uniqueNo:a}})):[],productId:c,shopId:f,skuId:h},t.next=10,(0,y.getOptionalProducts)(f);case 10:h=t.sent,h=(f=h||{}).data,0===f.code&&h&&h.length?(g={},h.map((function(t){g[(t||{}).uniqueNo]=t})),e.setState({optionalProductsBase:g},(function(){var t=e.bagProductList(!0);e.setProductDetail(s,t)}))):e.setState({optionalProductsBase:{},dataLoaded:!0,productDetail:i});case 13:case"end":return t.stop()}}),t,o)}))),function(t,e,o){return u.apply(this,arguments)}),e.setUserLocationAuthority=(s=x(n.default.mark((function t(r,a){var i;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=a||0,r)return t.next=4,(0,f.getLocation)();t.next=6;break;case 4:(i=t.sent)&&i.latitude?v.default.getInstance().events.trigger(_.default.eventNames.refreshMenu,{clearShop:!0}):0<a&&setTimeout((function(){e.setUserLocationAuthority(r,(a||0)-1)}),1e3);case 6:case"end":return t.stop()}}),t,o)}))),function(t,e){return s.apply(this,arguments)}),e.getProductDetail=(i=x(n.default.mark((function t(i,s){var u,c,d,p,l,f,v,m;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(f=e.props.shoppingBagStore,void 0!==(m=(f||{}).openDefaultShop)&&m)return t.next=5,(0,I.getUserLocationAuthority)();t.next=8;break;case 5:return t.sent?(0,I.showSystemLocationAuthority)({modal_parameter:{content:"hey，您可能未开启微信定位，请进入系统【设置】>>【隐私】>>【定位服务】中打开开关获取就近门店菜单或手动选择门店，即可享受下单服务",cancelText:"选择门店",confirmText:"授权定位",showCancel:!0,onCancelPress:function(){h.default.to(_.default.routes.chooseShop)}},callback:function(){e.setUserLocationAuthority(!0,6)}}):(0,I.showMiniLocationAuthority)(e.setUserLocationAuthority,{content:"开启喜茶GO定位授权获取就近门店菜单，或手动选择门店，即可享受下单服务",cancelText:"选择门店",onCancelPress:function(){h.default.to(_.default.routes.chooseShop)}}),t.abrupt("return");case 8:return e.setState({isShowContent:!0,dataLoaded:!1,productDetail:A}),u=function(){k.default.showToast({title:S.default.getLang("","index").common_request_error,icon:"none"})},t.prev=10,p=e.props.shoppingBagStore,l=p.shop,c=p.isAppointmentStatus,d=p.takeoutAddress,t.next=14,(0,y.getProductDetail)({shopId:l.id,productIds:""+i.id});case 14:0===(f=t.sent).code?(m=f.data.products,0<(p=void 0===m?[]:m).length?(l=a(p,1),f=l[0],m=f.specifications,p=void 0===m?[]:m,l=f.videos,m=void 0===l?[]:l,l=void 0===(l=f.skus)?[]:l,f.product_id,f=l,s&&(v=s.redemption_discount_value,f=l.map((function(t){var e=void 0===(o=t.price)?"1.00":o,o=void 0===(o=t.un_include_tax_price)?"1.00":o;return r({},t,{redemption_discount_price:v?""+Math.round(100*(0,g.times)(Number(e),Number(v)))/100:e,un_include_tax_redemption_discount_price:v?""+Math.round(100*(0,g.times)(Number(o),Number(v)))/100:o})}))),m=e.refactoringProduct(r({},i,{skus:f,specifications:p,videos:m},s)),e.setProductDetail({integratedProductInfo:m,isAppointmentStatus:c,takeoutAddress:d})):u()):u(),t.next=22;break;case 18:t.prev=18,t.t0=t.catch(10),k.default.hideLoading(),u();case 22:case"end":return t.stop()}}),t,o,[[10,18]])}))),function(t,e){return i.apply(this,arguments)}),e.setProductDetail=function(t,o){var n=(a=t||{}).integratedProductInfo,r=a.isAppointmentStatus,a=a.takeoutAddress;o=void 0!==(a=(r=(n=(0,w.generateProductDetailData)(n,r,!!a,o))||{}).supportReverseElection)&&a,a=r.productId,r=e.getNonAdditiveBagList(!0)||[],o&&a!==e.pId&&r&&r.length?(e.pId=a,e.checkOptionalProducts(r,n,t)):(e.pId=a,e.setState({dataLoaded:!0,productDetail:n}))},e.getNonAdditiveBagList=function(t){var o=(n=e.props).shoppingBagStore,n=void 0!==(r=n.isParty)&&r,r=e.state.optionalProductsBase;return o=(r=o||{}).shoppingBagList,r=r.partyBagList,(n?void 0===r?[]:r:void 0===o?[]:o).filter((function(t){var e=(o=t||{}).type,o=!1;return"IShoppingBagItem"===(void 0===e?"":e)&&(void 0!==(t=t.supportReverseElection)&&t||(o=!0)),o}))||[]},e.refactoringProduct=function(t){var e=void 0===(n=t.skus)?[]:n,o=t.images,n=t.videos,r=[].concat(D(o)),a=[],i=n&&n.length;return e.map((function(t){var e=void 0===(o=t.images)?[]:o,o=(r&&r.length)+(i?1:0)||-1;0<e.length&&(t.imgIndex=o),a.push(t),r.push.apply(r,D(e))})),t.imagesList=r,t.skus=a,t},e.closeSelectSpecification=function(){var t=e.props.isParty,o=void 0!==t&&t;e.pId=null,e.setState({dataLoaded:!1,isShowContent:!1}),v.default.getInstance().events.trigger(_.default.eventNames.closeSelectSpecification),setTimeout((function(){o||p.default.showTabBar({animation:!0})}),0)},e.productDetailItemClickAction=function(t,o){var n=e.state.productDetail,r=e.props.shoppingBagStore.takeoutAddress;"number"==typeof(r=(0,w.accessoryItemActionReGenerateProductDetailData)(t,o,n,!!r))?e.changeSwiperCurrent(r||null):r&&(e.setState({productDetail:r}),r=r&&r.imgIndex||null,e.changeSwiperCurrent(r||null))},e.setChangeSwiperScroll=function(t){e.changeScollViewForRn=t},e.changeSwiperCurrent=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;e.setState({imgIndex:t})},e.networkStatusChange=x(n.default.mark((function t(){return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:m.default.getNetworkType((function(t){t=void 0===(t=t.networkType)?"":t,e.setState({networkType:t})})),m.default.onNetworkStatusChange((function(t){e.setState({networkType:t.networkType})}));case 2:case"end":return t.stop()}}),t,o)}))),e.showShareMenu=function(){var t=(r=e.state.productDetail).name,o=r.imageURL,n=r.productId,r=r.skusData;(0,P.GetRoutePassParamSingleton)().shareProductData={name:t,productId:n,imgUrl:o,skuId:0<r.length?r[0].id:0},e.setState({isShowShareMenu:!0})},e.handleShareResult=function(){e.dismissShareMenu()},e.dismissShareMenu=function(){e.setState({isShowShareMenu:!1})},e.handleTouchMove=function(t){t.preventDefault(),t.stopPropagation()},e.customComponents=["ProductDetailBase","ProductShare"],L(e,t)}(function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)})(C,d.PureComponent),i(C,[{key:"_constructor",value:function(t){(function t(e,o,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,o);return void 0!==r?"value"in r?r.value:void 0!==(r=r.get)?r.call(n):void 0:null!==(e=Object.getPrototypeOf(e))?t(e,o,n):void 0})(C.prototype.__proto__||Object.getPrototypeOf(C.prototype),"_constructor",this).call(this,t),this.state={productDetail:r({},A),isShowContent:!1,networkType:"",imgIndex:null,isShowShareMenu:!1,dataLoaded:!1,rnShareData:null,optionalProductsBase:{}},this.$$refs=new p.default.RefsArray}},{key:"componentDidMount",value:function(){var t=void 0!==(t=this.props.isParty)&&t;v.default.getInstance().events.on(t?_.default.eventNames.partyProductDetail:_.default.eventNames.productDetail,this.getProductDetail),this.networkStatusChange()}},{key:"componentWillUnmount",value:function(){var t=void 0!==(t=this.props.isParty)&&t;v.default.getInstance().events.off(t?_.default.eventNames.partyProductDetail:_.default.eventNames.productDetail)}},{key:"_createData",value:function(){this.__state=arguments[0]||this.state||{},this.__props=arguments[1]||this.props||{};var t=this.$prefix,e=(0,d.genCompid)(t+"$compid__1438"),o=(p=a(e,2))[0],n=p[1],r=(0,d.genCompid)(t+"$compid__1439"),i=(l=a(r,2))[0],s=l[1],u=void 0!==(h=this.__props.isParty)&&h,c=(f=this.__state).productDetail,p=(e=f.isShowContent,f.networkType),l=(t=f.imgIndex,r=f.isShowShareMenu,f.dataLoaded),f=void 0===(f.rnShareData,h=f.optionalProductsBase)?{}:h,h=(0,d.internal_inline_style)({elevation:2});return e&&d.propsManager.set({productDetail:c,networkType:p,showType:1,dataLoaded:l,imgIndex:t,onAccessoryItemAction:this.productDetailItemClickAction,onCloseSelectSpecAction:this.closeSelectSpecification,onChangeSwiperCurrent:this.changeSwiperCurrent,onShareAction:this.showShareMenu,isParty:u,setChangeSwiperScroll:this.setChangeSwiperScroll,optionalProductsBase:f,getNonAdditiveBagList:this.getNonAdditiveBagList,getBagProductList:this.bagProductList},n,o),r&&d.propsManager.set({productDetail:c,isShow:r,dismiss:this.dismissShareMenu},s,i),Object.assign(this.__state,{anonymousState__temp:h,$compid__1438:n,$compid__1439:s}),this.__state}}]),i=u=C,u.$$events=["handleTouchMove","closeSelectSpecification"],u.$$componentPath="pages/index/_index/product_detail/product_detail",i=i,i=(0,c.__decorate)([(0,l.inject)("activityStore","shoppingBagStore"),l.observer],i),e.default=i,Component(o(0).default.createComponent(i))}},[[3558,0,1,2,3]]]);
},{isPage:false,isComponent:true,currentFile:'pages/index/_index/product_detail/product_detail.js'});require("pages/index/_index/product_detail/product_detail.js");