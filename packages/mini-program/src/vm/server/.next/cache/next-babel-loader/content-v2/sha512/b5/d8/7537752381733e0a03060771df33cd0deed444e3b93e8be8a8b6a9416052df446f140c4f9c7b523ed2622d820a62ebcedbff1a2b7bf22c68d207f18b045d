{"ast":null,"code":"import _regeneratorRuntime from \"/Users/aniwei/Desktop/tickjs/packages/mini-program/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/aniwei/Desktop/tickjs/packages/mini-program/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _s = $RefreshSig$();\n\nimport { useEffect, useMemo } from 'react';\n\nfunction scriptLoader(_x) {\n  return _scriptLoader.apply(this, arguments);\n}\n\nfunction _scriptLoader() {\n  _scriptLoader = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(src) {\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n              var script = document.createElement('script');\n              script.type = 'application/javascript';\n              script.src = src;\n\n              script.onload = function () {\n                resolve(src);\n              };\n\n              script.onerror = function (error) {\n                return reject(error);\n              };\n\n              script.src = src;\n              document.head.appendChild(script);\n            }));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _scriptLoader.apply(this, arguments);\n}\n\nexport function useScript(src) {\n  _s();\n\n  var scripts = useMemo(function () {\n    return [];\n  }, []);\n  scripts.push(src);\n  useEffect(function () {\n    var run = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var script;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                script = scripts.shift();\n\n              case 1:\n                if (!script) {\n                  _context.next = 14;\n                  break;\n                }\n\n                if (!(typeof script === 'function')) {\n                  _context.next = 7;\n                  break;\n                }\n\n                _context.next = 5;\n                return script();\n\n              case 5:\n                _context.next = 10;\n                break;\n\n              case 7:\n                if (!(typeof script === 'string')) {\n                  _context.next = 10;\n                  break;\n                }\n\n                _context.next = 10;\n                return scriptLoader(script);\n\n              case 10:\n                debugger;\n                script = scripts.shift();\n                _context.next = 1;\n                break;\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function run() {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    run();\n  }, []);\n}\n\n_s(useScript, \"vU3vqAfDR9h7/RgY0NKWEjz410g=\");","map":{"version":3,"sources":["/Users/aniwei/Desktop/tickjs/packages/mini-program/src/vm/server/hooks/useScript.ts"],"names":["useEffect","useMemo","scriptLoader","src","Promise","resolve","reject","script","document","createElement","type","onload","onerror","error","head","appendChild","useScript","scripts","push","run","shift"],"mappings":";;;;;AAAA,SAASA,SAAT,EAAoBC,OAApB,QAAmC,OAAnC;;SAEeC,Y;;;;;2EAAf,kBAA6BC,GAA7B;AAAA;AAAA;AAAA;AAAA;AAAA,8CACS,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtC,kBAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;AAEAF,cAAAA,MAAM,CAACG,IAAP,GAAc,wBAAd;AACAH,cAAAA,MAAM,CAACJ,GAAP,GAAaA,GAAb;;AAEAI,cAAAA,MAAM,CAACI,MAAP,GAAgB,YAAM;AACpBN,gBAAAA,OAAO,CAACF,GAAD,CAAP;AACD,eAFD;;AAGAI,cAAAA,MAAM,CAACK,OAAP,GAAiB,UAACC,KAAD;AAAA,uBAAWP,MAAM,CAACO,KAAD,CAAjB;AAAA,eAAjB;;AACAN,cAAAA,MAAM,CAACJ,GAAP,GAAaA,GAAb;AAEAK,cAAAA,QAAQ,CAACM,IAAT,CAAcC,WAAd,CAA0BR,MAA1B;AACD,aAbM,CADT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAiBA,OAAO,SAASS,SAAT,CAAoBb,GAApB,EAA4C;AAAA;;AACjD,MAAMc,OAAc,GAAGhB,OAAO,CAAC;AAAA,WAAM,EAAN;AAAA,GAAD,EAAW,EAAX,CAA9B;AAEAgB,EAAAA,OAAO,CAACC,IAAR,CAAaf,GAAb;AAEAH,EAAAA,SAAS,CAAC,YAAM;AACd,QAAMmB,GAAG;AAAA,0EAAG;AAAA;AAAA;AAAA;AAAA;AAAA;AACNZ,gBAAAA,MADM,GACGU,OAAO,CAACG,KAAR,EADH;;AAAA;AAAA,qBAGHb,MAHG;AAAA;AAAA;AAAA;;AAAA,sBAIJ,OAAOA,MAAP,KAAkB,UAJd;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAKAA,MAAM,EALN;;AAAA;AAAA;AAAA;;AAAA;AAAA,sBAMG,OAAOA,MAAP,KAAkB,QANrB;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAOAL,YAAY,CAACK,MAAD,CAPZ;;AAAA;AAUR;AAEAA,gBAAAA,MAAM,GAAGU,OAAO,CAACG,KAAR,EAAT;AAZQ;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAH;;AAAA,sBAAHD,GAAG;AAAA;AAAA;AAAA,OAAT;;AAgBAA,IAAAA,GAAG;AACJ,GAlBQ,EAkBN,EAlBM,CAAT;AAmBD;;GAxBeH,S","sourcesContent":["import { useEffect, useMemo } from 'react';\n\nasync function scriptLoader (src): Promise<any> {\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    \n    script.type = 'application/javascript';\n    script.src = src;\n\n    script.onload = () => {\n      resolve(src);\n    }\n    script.onerror = (error) => reject(error);\n    script.src = src;\n\n    document.head.appendChild(script);\n  });\n}\n\nexport function useScript (src: string | Function) {\n  const scripts: any[] = useMemo(() => [], []);\n\n  scripts.push(src);\n\n  useEffect(() => {\n    const run = async () => {\n      let script = scripts.shift();\n      \n      while (script) {\n        if (typeof script === 'function') {\n          await script();\n        } else if (typeof script === 'string') {\n          await scriptLoader(script);\n        }\n\n        debugger;\n\n        script = scripts.shift();\n      }\n    }\n\n    run();\n  }, []);\n}"]},"metadata":{},"sourceType":"module"}